{"version":2,"kind":"Notebook","sha256":"37ac971cf10086929b22cae799e07b3cdd6a228417d34164e0fcc62d9d0acf67","slug":"gfm-maximum-flood-extent-local","location":"/source/services/GFM/gfm_maximum_flood_extent_local.ipynb","dependencies":[],"frontmatter":{"title":"GFM maximum flood extent with STAC","subtitle":"This notebook will demonstrate how to find data using STAC, load it into a xarray object and calculate a result.","tags":["GFM","STAC"],"copyright":"© 2024 eodc","authors":[{"id":"Author: eodc","name":"Author: eodc"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/e09f7271f6c188a68020a7d6a49ba21c.svg","kernelspec":{"name":"python3","display_name":".venv","language":"python"},"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"gfm_maximum_flood_extent_local.ipynb","url":"/gfm_maximum_flood_ex-9cdf9463cbc5df0d73d77ac62c60b242.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"As an example, we will calculate the maximum flood extent of a certain time range\nover an area of interest in Argentina. In March 2025, the area south of Buenos\nAires suffered from severe weather and floods.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BnmIjozB55"}],"key":"AmLr6DxBZk"}],"key":"U0mWNiHTIJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First some imports","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OYfJx4bBc0"}],"identifier":"first-some-imports","label":"First some imports","html_id":"first-some-imports","implicit":true,"key":"PgRFk4k0FG"}],"key":"xcLXI5Bymd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import pyproj\nimport rioxarray # noqa\nimport xarray as xr\nfrom datetime import datetime\nfrom shapely.geometry import box\nfrom pystac_client import Client\nfrom odc import stac as odc_stac","key":"WmybAlM9nM"},{"type":"output","id":"6R7DaL--vFBrjLVH7y4Ld","data":[],"key":"GU5CksQBpj"}],"key":"Szuw34rFBA"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Search and load data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WgJyA3a1ih"}],"identifier":"search-and-load-data","label":"Search and load data","html_id":"search-and-load-data","implicit":true,"key":"MAG1qaM4KO"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We will define our area (AOI) and time range of interest for which we want\nto calculate the maximum flood extent for. For defining a bounding box, you can\nuse ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pRSyzeZlIp"},{"type":"link","url":"http://bboxfinder.com","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"this web tool","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UaoXahtoj3"}],"urlSource":"http://bboxfinder.com","key":"JzuRpZoxEV"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"tdUNL0ilJ7"}],"key":"JhBcOjKxuJ"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"All GFM data is registered as a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"UjyKL7GEjH"},{"type":"link","url":"https://stacspec.org/en/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"STAC","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"KCkKgXvyKn"}],"urlSource":"https://stacspec.org/en/","key":"FuN0UxRQwH"},{"type":"text","value":" collection.\nPlease find more information about STAC in our ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hiox6KpNSx"},{"type":"link","url":"https://docs.eodc.eu/services/stac.html","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"documentation","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Ey7nPbNXF4"}],"urlSource":"https://docs.eodc.eu/services/stac.html","key":"A8duW7ON1j"},{"type":"text","value":".","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"QUOUTmBlEp"}],"key":"hpjWb4nyyu"}],"key":"t81rA35GHZ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Define the API URL\napi_url = \"https://stac.eodc.eu/api/v1\"\n\n# Define the STAC collection ID\ncollection_id = \"GFM\"\n\n# Define the area of interest (AOI) as a bounding box\naoi = box(-62.030182,-37.485756,-60.540161,-36.589068)\n\n# Define the time range for the search\ntime_range = (datetime(2025, 3, 1), datetime(2025, 4, 1))\n\n# Open the STAC catalog using the specified API URL\neodc_catalog = Client.open(api_url)\n\n# Perform a search in the catalog with the specified parameters\nsearch = eodc_catalog.search(\n    max_items=1000,             # Maximum number of items to return\n    collections=collection_id,  # The collection to search within\n    intersects=aoi,             # The area of interest\n    datetime=time_range         # The time range for the search\n)\n\n# Collect the found items into an item collection\nitems = search.item_collection()\n\nprint(f\"On EODC we found {len(items)} items for the given search query\")","key":"w8R9fPN2wv"},{"type":"output","id":"M3mudK6x5InB7G_qfjqHl","data":[{"name":"stdout","output_type":"stream","text":"On EODC we found 92 items for the given search query\n"}],"key":"aF4wEc5hQW"}],"key":"tfvdwZcfOm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"We will use the found STAC items to load the data into a xarray.Dataset\nobject. In order to achieve this, we need to specify the bands which we want to\nload. To calculate the maximum flood extent, we are interested in the\n“ensemble_flood_extent” layer of each GFM item. Furthermore, we need to specify\nthe coordinate reference system (CRS) as well as the resolution of the data. All\nnecessary metadata is saved in each STAC item.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e6t6DoWryl"}],"key":"IvmECpRdYf"}],"key":"R4huM9szpm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Extract the coordinate reference system (CRS) from the first item's properties\ncrs = pyproj.CRS.from_wkt(items[0].properties[\"proj:wkt2\"])\n\n# Set the resolution of the data\nresolution = items[0].properties['gsd']\n\n# Specify the bands to load\nbands = [\"ensemble_flood_extent\"]\n\n# Load the data using odc-stac with the specified parameters\nxx = odc_stac.load(\n    items, \n    bbox=aoi.bounds,   # Define the bounding box for the area of interest\n    crs=crs,   # Set the coordinate reference system\n    bands=bands,   # Specify the bands to load\n    resolution=resolution,   # Set the resolution of the data\n    dtype='uint8',   # Define the data type\n    groupby=\"solar_day\",\n    # fail_on_error=False,\n)\n\nxx","key":"JSQHC6R5D0"},{"type":"output","id":"jyUlrto8LVR86O2gwf0Jz","data":[{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));\n  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));\n  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));\n  --xr-border-color: var(--jp-border-color2, #e0e0e0);\n  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);\n  --xr-background-color: var(--jp-layout-color0, white);\n  --xr-background-color-row-even: var(--jp-layout-color1, white);\n  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);\n}\n\nhtml[theme=\"dark\"],\nhtml[data-theme=\"dark\"],\nbody[data-theme=\"dark\"],\nbody.vscode-dark {\n  --xr-font-color0: rgba(255, 255, 255, 1);\n  --xr-font-color2: rgba(255, 255, 255, 0.54);\n  --xr-font-color3: rgba(255, 255, 255, 0.38);\n  --xr-border-color: #1f1f1f;\n  --xr-disabled-color: #515151;\n  --xr-background-color: #111111;\n  --xr-background-color-row-even: #111111;\n  --xr-background-color-row-odd: #313131;\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 0 20px 0 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: inline-block;\n  opacity: 0;\n  height: 0;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:focus + label {\n  border: 2px solid var(--xr-font-color0);\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: \"►\";\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: \"▼\";\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: \"(\";\n}\n\n.xr-dim-list:after {\n  content: \")\";\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: \",\";\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  margin-bottom: 0;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  background-color: var(--xr-background-color) !important;\n  padding-bottom: 5px !important;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt; Size: 412MB\nDimensions:                (y: 5012, x: 6845, time: 12)\nCoordinates:\n  * y                      (y) float64 40kB 3.089e+06 3.089e+06 ... 2.989e+06\n  * x                      (x) float64 55kB 7.117e+06 7.117e+06 ... 7.254e+06\n    spatial_ref            int32 4B 0\n  * time                   (time) datetime64[ns] 96B 2025-03-03T09:23:46 ... ...\nData variables:\n    ensemble_flood_extent  (time, y, x) uint8 412MB 0 0 0 0 ... 255 255 255 255</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-40e45450-6fc6-4f0e-9711-fdd199a79830' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-40e45450-6fc6-4f0e-9711-fdd199a79830' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>y</span>: 5012</li><li><span class='xr-has-index'>x</span>: 6845</li><li><span class='xr-has-index'>time</span>: 12</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-cf507f88-f7d7-4ac4-adc4-60037e6e4f2b' class='xr-section-summary-in' type='checkbox'  checked><label for='section-cf507f88-f7d7-4ac4-adc4-60037e6e4f2b' class='xr-section-summary' >Coordinates: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.089e+06 3.089e+06 ... 2.989e+06</div><input id='attrs-2b6fc1cc-9685-4eee-843b-045d1b760ad0' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-2b6fc1cc-9685-4eee-843b-045d1b760ad0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d117cb72-f907-4343-9313-30abdb30732c' class='xr-var-data-in' type='checkbox'><label for='data-d117cb72-f907-4343-9313-30abdb30732c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>metre</dd><dt><span>resolution :</span></dt><dd>-20.0</dd><dt><span>crs :</span></dt><dd>PROJCS[&quot;Azimuthal_Equidistant&quot;,GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]],PROJECTION[&quot;Azimuthal_Equidistant&quot;],PARAMETER[&quot;false_easting&quot;,7257179.23559],PARAMETER[&quot;false_northing&quot;,5592024.44605],PARAMETER[&quot;longitude_of_center&quot;,-60.5],PARAMETER[&quot;latitude_of_center&quot;,-14.0],UNIT[&quot;metre&quot;,1,AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]]]</dd></dl></div><div class='xr-var-data'><pre>array([3089470., 3089450., 3089430., ..., 2989290., 2989270., 2989250.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>7.117e+06 7.117e+06 ... 7.254e+06</div><input id='attrs-420e9007-3ae9-4033-abf5-65aeb804ed44' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-420e9007-3ae9-4033-abf5-65aeb804ed44' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9a382331-6ee0-4dbc-9b0a-cf33263b4353' class='xr-var-data-in' type='checkbox'><label for='data-9a382331-6ee0-4dbc-9b0a-cf33263b4353' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>metre</dd><dt><span>resolution :</span></dt><dd>20.0</dd><dt><span>crs :</span></dt><dd>PROJCS[&quot;Azimuthal_Equidistant&quot;,GEOGCS[&quot;WGS 84&quot;,DATUM[&quot;WGS_1984&quot;,SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],PRIMEM[&quot;Greenwich&quot;,0],UNIT[&quot;degree&quot;,0.0174532925199433],AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]],PROJECTION[&quot;Azimuthal_Equidistant&quot;],PARAMETER[&quot;false_easting&quot;,7257179.23559],PARAMETER[&quot;false_northing&quot;,5592024.44605],PARAMETER[&quot;longitude_of_center&quot;,-60.5],PARAMETER[&quot;latitude_of_center&quot;,-14.0],UNIT[&quot;metre&quot;,1,AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]]]</dd></dl></div><div class='xr-var-data'><pre>array([7116650., 7116670., 7116690., ..., 7253490., 7253510., 7253530.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>spatial_ref</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>0</div><input id='attrs-eb18e928-fa65-4ac7-a154-7d78a9aaf48b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-eb18e928-fa65-4ac7-a154-7d78a9aaf48b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-25de8145-b539-43a8-9bbe-94bc368e0643' class='xr-var-data-in' type='checkbox'><label for='data-25de8145-b539-43a8-9bbe-94bc368e0643' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>spatial_ref :</span></dt><dd>PROJCRS[&quot;Azimuthal_Equidistant&quot;,BASEGEOGCRS[&quot;WGS 84&quot;,DATUM[&quot;World Geodetic System 1984&quot;,ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,LENGTHUNIT[&quot;metre&quot;,1]]],PRIMEM[&quot;Greenwich&quot;,0,ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],ID[&quot;EPSG&quot;,4326]],CONVERSION[&quot;unnamed&quot;,METHOD[&quot;Azimuthal Equidistant&quot;,ID[&quot;EPSG&quot;,1125]],PARAMETER[&quot;False easting&quot;,7257179.23559,LENGTHUNIT[&quot;metre&quot;,1],ID[&quot;EPSG&quot;,8806]],PARAMETER[&quot;False northing&quot;,5592024.44605,LENGTHUNIT[&quot;metre&quot;,1],ID[&quot;EPSG&quot;,8807]],PARAMETER[&quot;Longitude of natural origin&quot;,-60.5,ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],ID[&quot;EPSG&quot;,8802]],PARAMETER[&quot;Latitude of natural origin&quot;,-14,ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],ID[&quot;EPSG&quot;,8801]]],CS[Cartesian,2],AXIS[&quot;(E)&quot;,east,ORDER[1],LENGTHUNIT[&quot;metre&quot;,1,ID[&quot;EPSG&quot;,9001]]],AXIS[&quot;(N)&quot;,north,ORDER[2],LENGTHUNIT[&quot;metre&quot;,1,ID[&quot;EPSG&quot;,9001]]]]</dd><dt><span>crs_wkt :</span></dt><dd>PROJCRS[&quot;Azimuthal_Equidistant&quot;,BASEGEOGCRS[&quot;WGS 84&quot;,DATUM[&quot;World Geodetic System 1984&quot;,ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,LENGTHUNIT[&quot;metre&quot;,1]]],PRIMEM[&quot;Greenwich&quot;,0,ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],ID[&quot;EPSG&quot;,4326]],CONVERSION[&quot;unnamed&quot;,METHOD[&quot;Azimuthal Equidistant&quot;,ID[&quot;EPSG&quot;,1125]],PARAMETER[&quot;False easting&quot;,7257179.23559,LENGTHUNIT[&quot;metre&quot;,1],ID[&quot;EPSG&quot;,8806]],PARAMETER[&quot;False northing&quot;,5592024.44605,LENGTHUNIT[&quot;metre&quot;,1],ID[&quot;EPSG&quot;,8807]],PARAMETER[&quot;Longitude of natural origin&quot;,-60.5,ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],ID[&quot;EPSG&quot;,8802]],PARAMETER[&quot;Latitude of natural origin&quot;,-14,ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],ID[&quot;EPSG&quot;,8801]]],CS[Cartesian,2],AXIS[&quot;(E)&quot;,east,ORDER[1],LENGTHUNIT[&quot;metre&quot;,1,ID[&quot;EPSG&quot;,9001]]],AXIS[&quot;(N)&quot;,north,ORDER[2],LENGTHUNIT[&quot;metre&quot;,1,ID[&quot;EPSG&quot;,9001]]]]</dd><dt><span>semi_major_axis :</span></dt><dd>6378137.0</dd><dt><span>semi_minor_axis :</span></dt><dd>6356752.314245179</dd><dt><span>inverse_flattening :</span></dt><dd>298.257223563</dd><dt><span>reference_ellipsoid_name :</span></dt><dd>WGS 84</dd><dt><span>longitude_of_prime_meridian :</span></dt><dd>0.0</dd><dt><span>prime_meridian_name :</span></dt><dd>Greenwich</dd><dt><span>geographic_crs_name :</span></dt><dd>WGS 84</dd><dt><span>horizontal_datum_name :</span></dt><dd>World Geodetic System 1984</dd><dt><span>projected_crs_name :</span></dt><dd>Azimuthal_Equidistant</dd><dt><span>grid_mapping_name :</span></dt><dd>azimuthal_equidistant</dd><dt><span>latitude_of_projection_origin :</span></dt><dd>-14.0</dd><dt><span>longitude_of_projection_origin :</span></dt><dd>-60.5</dd><dt><span>false_easting :</span></dt><dd>7257179.23559</dd><dt><span>false_northing :</span></dt><dd>5592024.44605</dd><dt><span>GeoTransform :</span></dt><dd>7116640 20 0 3089480 0 -20</dd></dl></div><div class='xr-var-data'><pre>array(0, dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2025-03-03T09:23:46 ... 2025-03-...</div><input id='attrs-2ec22181-3060-4189-bc76-edd1042851da' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2ec22181-3060-4189-bc76-edd1042851da' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d825f1c4-ee92-47ca-aa70-820f804584ae' class='xr-var-data-in' type='checkbox'><label for='data-d825f1c4-ee92-47ca-aa70-820f804584ae' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2025-03-03T09:23:46.000000000&#x27;, &#x27;2025-03-05T09:07:21.000000000&#x27;,\n       &#x27;2025-03-08T09:31:38.000000000&#x27;, &#x27;2025-03-10T09:15:28.000000000&#x27;,\n       &#x27;2025-03-12T08:59:48.000000000&#x27;, &#x27;2025-03-15T09:23:46.000000000&#x27;,\n       &#x27;2025-03-17T09:07:21.000000000&#x27;, &#x27;2025-03-20T09:31:39.000000000&#x27;,\n       &#x27;2025-03-22T09:15:29.000000000&#x27;, &#x27;2025-03-24T08:59:48.000000000&#x27;,\n       &#x27;2025-03-27T09:23:46.000000000&#x27;, &#x27;2025-03-29T09:07:22.000000000&#x27;],\n      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-37e244d5-6884-45be-bcbf-1a12c5d6aa0b' class='xr-section-summary-in' type='checkbox'  checked><label for='section-37e244d5-6884-45be-bcbf-1a12c5d6aa0b' class='xr-section-summary' >Data variables: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>ensemble_flood_extent</span></div><div class='xr-var-dims'>(time, y, x)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 0 ... 255 255 255 255 255</div><input id='attrs-f9b64037-5cdc-4a90-b025-ad7c740977ba' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f9b64037-5cdc-4a90-b025-ad7c740977ba' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a4a93951-fac0-4086-b370-74b818a3e55c' class='xr-var-data-in' type='checkbox'><label for='data-a4a93951-fac0-4086-b370-74b818a3e55c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>nodata :</span></dt><dd>255</dd></dl></div><div class='xr-var-data'><pre>array([[[  0,   0,   0, ..., 255, 255, 255],\n        [  0,   0,   0, ..., 255, 255, 255],\n        [  0,   0,   0, ..., 255, 255, 255],\n        ...,\n        [  0,   0,   0, ..., 255, 255, 255],\n        [  0,   0,   0, ..., 255, 255, 255],\n        [  0,   0,   0, ..., 255, 255, 255]],\n\n       [[255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255],\n        ...,\n        [255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255]],\n\n       [[255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255],\n        ...,\n...\n        ...,\n        [255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255]],\n\n       [[  0,   0,   0, ..., 255, 255, 255],\n        [  0,   0,   0, ..., 255, 255, 255],\n        [  0,   0,   0, ..., 255, 255, 255],\n        ...,\n        [  0,   0,   0, ..., 255, 255, 255],\n        [  0,   0,   0, ..., 255, 255, 255],\n        [  0,   0,   0, ..., 255, 255, 255]],\n\n       [[255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255],\n        ...,\n        [255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255],\n        [255, 255, 255, ..., 255, 255, 255]]], dtype=uint8)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b0b94634-13a6-46e0-be50-ae27c0670a04' class='xr-section-summary-in' type='checkbox'  ><label for='section-b0b94634-13a6-46e0-be50-ae27c0670a04' class='xr-section-summary' >Indexes: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>y</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-f3792c7f-344e-4c1e-8495-089e0610a1dd' class='xr-index-data-in' type='checkbox'/><label for='index-f3792c7f-344e-4c1e-8495-089e0610a1dd' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([3089470.0, 3089450.0, 3089430.0, 3089410.0, 3089390.0, 3089370.0,\n       3089350.0, 3089330.0, 3089310.0, 3089290.0,\n       ...\n       2989430.0, 2989410.0, 2989390.0, 2989370.0, 2989350.0, 2989330.0,\n       2989310.0, 2989290.0, 2989270.0, 2989250.0],\n      dtype=&#x27;float64&#x27;, name=&#x27;y&#x27;, length=5012))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>x</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-65ab9c7f-5fb7-4dfe-bdfb-a35ab8cd3411' class='xr-index-data-in' type='checkbox'/><label for='index-65ab9c7f-5fb7-4dfe-bdfb-a35ab8cd3411' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(Index([7116650.0, 7116670.0, 7116690.0, 7116710.0, 7116730.0, 7116750.0,\n       7116770.0, 7116790.0, 7116810.0, 7116830.0,\n       ...\n       7253350.0, 7253370.0, 7253390.0, 7253410.0, 7253430.0, 7253450.0,\n       7253470.0, 7253490.0, 7253510.0, 7253530.0],\n      dtype=&#x27;float64&#x27;, name=&#x27;x&#x27;, length=6845))</pre></div></li><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><input type='checkbox' disabled/><label></label><input id='index-ed26354a-da31-4881-b102-a66ab160d8f5' class='xr-index-data-in' type='checkbox'/><label for='index-ed26354a-da31-4881-b102-a66ab160d8f5' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2025-03-03 09:23:46&#x27;, &#x27;2025-03-05 09:07:21&#x27;,\n               &#x27;2025-03-08 09:31:38&#x27;, &#x27;2025-03-10 09:15:28&#x27;,\n               &#x27;2025-03-12 08:59:48&#x27;, &#x27;2025-03-15 09:23:46&#x27;,\n               &#x27;2025-03-17 09:07:21&#x27;, &#x27;2025-03-20 09:31:39&#x27;,\n               &#x27;2025-03-22 09:15:29&#x27;, &#x27;2025-03-24 08:59:48&#x27;,\n               &#x27;2025-03-27 09:23:46&#x27;, &#x27;2025-03-29 09:07:22&#x27;],\n              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-e7e2a44f-5dff-4efb-921f-146f10109818' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-e7e2a44f-5dff-4efb-921f-146f10109818' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>","content_type":"text/html"},"text/plain":{"content":"<xarray.Dataset> Size: 412MB\nDimensions:                (y: 5012, x: 6845, time: 12)\nCoordinates:\n  * y                      (y) float64 40kB 3.089e+06 3.089e+06 ... 2.989e+06\n  * x                      (x) float64 55kB 7.117e+06 7.117e+06 ... 7.254e+06\n    spatial_ref            int32 4B 0\n  * time                   (time) datetime64[ns] 96B 2025-03-03T09:23:46 ... ...\nData variables:\n    ensemble_flood_extent  (time, y, x) uint8 412MB 0 0 0 0 ... 255 255 255 255","content_type":"text/plain"}}}],"key":"mpyFkInPoP"}],"key":"pDEht7BWCK"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Process locally","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Bfwl5JVdsW"}],"identifier":"process-locally","label":"Process locally","html_id":"process-locally","implicit":true,"key":"FdDhEVQyf4"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"First, we filter the data to exclude invalid values and calculate the sum along\nthe time dimension. The maximum flood extent refers to the largest area covered\nby flooded pixels during the specified time range. Therefore, we convert the\nresult to a binary mask where each pixel is set to 1 if it was flooded during\nthe specified time range, and 0 if it was not. Then we start the computation on\nthe cluster and save the result as a compressed TIFF file. This file can be\nvisualized in e.g. QGIS.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LqTV9URdkJ"}],"key":"iuRkuxwT8q"}],"key":"n7biYGD4WX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Filter the data to exclude values of 255 (nodata) and 0 (no-flood), then sum\n# along the \"time\" dimension \ndata = xx[\"ensemble_flood_extent\"]\nresult = data.where((data != 255) & (data != 0)).sum(dim=\"time\")\n\n# Convert the result to binary (1 where the sum is greater than 0, otherwise 0)\n# and set the data type to uint8 \nresult = xr.where(result > 0, 1, 0).astype(\"uint8\")\n\n# Save the computed result to a GeoTIFF file with LZW compression\nresult.rio.to_raster(\"./max_flood_argentina_202503.tif\", compress=\"LZW\")","key":"QdyJkk5tzF"},{"type":"output","id":"qqn-iTCAazRzuCG_zL54y","data":[],"key":"KLTDF4coFj"}],"key":"TFgRXVVVw4"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot with matplotlib","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W74jkP9UP9"}],"identifier":"plot-with-matplotlib","label":"Plot with matplotlib","html_id":"plot-with-matplotlib","implicit":true,"key":"wYYGjwxHR7"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Additionally, we can plot a part of the result with the Python library matplotlib.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mhN4Q4YboL"}],"key":"yL3Qet0fIE"}],"key":"T9D9nVDMBN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nfrom matplotlib.colors import ListedColormap\ncmap = ListedColormap(['none', 'blue'])\n\n\nplt.figure()\nplt.imshow(result[:5000, :5000], cmap=cmap)\nplt.title(\"GFM Maximum Flood Extent\")\nplt.show()","key":"Fv1GDHvmSd"},{"type":"output","id":"uvmz9xH3OyDc76pfhdnAi","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7e18b6a935e53785f036ee2b8b3153e9","path":"/7e18b6a935e53785f036ee2b8b3153e9.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}}],"key":"EBYMYBAi51"}],"key":"xMOjmlKovC"}],"key":"wo9Um5hpMf"},"references":{"cite":{"order":[],"data":{}}}}