{"version":2,"kind":"Article","sha256":"722b7c48d30f28a1d14b654e1fedd6e2f52e31314008cb1eb9368bbb8d4a549a","slug":"openeo-processes","location":"/source/services/OPENEO/openeo-processes.md","dependencies":[],"frontmatter":{"title":"Adding a new process to the openEO processing dask","content_includes_title":false,"numbering":{"title":{"offset":2}},"exports":[{"format":"md","filename":"openeo-processes.md","url":"/openeo-processes-825b05efdd7b37c6f491c599bf9c96c6.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Overview","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rySsUvxVa6"}],"identifier":"overview","label":"Overview","html_id":"overview","implicit":true,"key":"txWDceRESy"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"EODC’s openEO backend can be extended with community processes. This documentation explains the steps you need to follow if you want to add your own process. There is also an ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rSs75U1068"},{"type":"link","url":"https://github.com/Open-EO/openeo-processes-dask/blob/main/.github/CONTRIBUTING.md","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"official guide","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"weXvC7keOx"}],"urlSource":"https://github.com/Open-EO/openeo-processes-dask/blob/main/.github/CONTRIBUTING.md","data":{"kind":"file","org":"Open-EO","repo":"openeo-processes-dask","reference":"main","file":".github/CONTRIBUTING.md","raw":"https://raw.githubusercontent.com/Open-EO/openeo-processes-dask/main/.github/CONTRIBUTING.md"},"internal":false,"protocol":"github","key":"ordwIsKRtN"},{"type":"text","value":" in the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BR7hsvyTLq"},{"type":"link","url":"https://github.com/Open-EO/openeo-processes-dask","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"openEO-processes-dask github","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Bg6Wob2Mdp"}],"urlSource":"https://github.com/Open-EO/openeo-processes-dask","error":true,"key":"xh8zTLrhpP"},{"type":"text","value":".","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eidMW0l6Ti"}],"key":"efui49tBEY"},{"type":"heading","depth":2,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"1. Example Process","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nTjlQiEb2T"}],"identifier":"id-1-example-process","label":"1. Example Process","html_id":"id-1-example-process","implicit":true,"key":"seyG0UyRec"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"The process by which the procedure is described is a process to detect deep moist convection. Deep moist convection (DC) is associated with dangerous weather phenomena such as torrential rain, flash floods, large hail and tornadoes. The release of latent heat inside deep convective clouds often plays a crucial role. Studies have shown that DC and overshooting cloud tops penetrate into the lowest stratosphere and enable the exchange of gases from the troposphere deep into the stratosphere. The Sentinel satellites offer the possibility to monitor DC around the globe, independent of the emissivity of the ground. Detecting Deep Moist Convection (DDMC) is a combination of Deep Moist Convection, low- and mid-level cloudiness.\nThe template for the process comes from Stavros Dafis and can be found on ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"HSJgjynKjR"},{"type":"link","url":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel-2/deep_moist_convection/","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"sentinelhub","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"AHToikgeIt"}],"urlSource":"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel-2/deep_moist_convection/","key":"x6k6uoTFmi"},{"type":"text","value":".","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"b9QunZvUzi"}],"key":"C1eUPc2JBc"},{"type":"heading","depth":2,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"2. Preparation","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"fMAGITslYN"}],"identifier":"id-2-preparation","label":"2. Preparation","html_id":"id-2-preparation","implicit":true,"key":"I6B4UH0OmQ"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"To add your own process to openeo, three different files must be prepared. One is the .py file with the process, one .py file with tests and the other is a .json file with all the information about the process.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"VEThe1EzHD"}],"key":"WILmdffJPP"},{"type":"heading","depth":3,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Python process file","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"sGmPP6CJu2"}],"identifier":"python-process-file","label":"Python process file","html_id":"python-process-file","implicit":true,"key":"UbQVv11cnu"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"With the Python file for the process, it is important that it really only contains the relevant code and no tests or other implementations. The process should also be written in one function if possible. Apart from the function, the file should contain all the required (openeo) libraries and small labels or explanations of the procedure.\nYou find examples for python scripts in the ","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"O6M8GuNPWt"},{"type":"link","url":"https://github.com/Open-EO/openeo-processes-dask/tree/main/openeo_processes_dask","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"openEO-processes-dask github","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"kf4Zzmc5QB"}],"urlSource":"https://github.com/Open-EO/openeo-processes-dask/tree/main/openeo_processes_dask","error":true,"key":"kl8cjpMpsb"},{"type":"text","value":".","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"wgKcdr1JMw"}],"key":"oIaJScqMSo"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"To add the process to the list of processes, you need to add your process to the ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"wNrViyl5ZS"},{"type":"inlineCode","value":"openeo_processes_dask/process_implementations/__init__.py","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"GVmoX4zjZf"},{"type":"text","value":" file.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"G4rN3W6JKT"}],"key":"Z8igAdRVpF"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"All example files for DDMC can be found at the bottom of this document.","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"DbbqPievtp"}],"key":"d5QR2cDZxB"},{"type":"heading","depth":3,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Python test file","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"rj2Hp7j9O5"}],"identifier":"python-test-file","label":"Python test file","html_id":"python-test-file","implicit":true,"key":"NMX0gWDA4N"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"The process must be sufficiently tested before it can be integrated into the production system. A test file must therefore be created. All possible errors and problems must be tested here using abstract data. Possible problems are incorrect input or coding errors, for example.","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"Fu930fg1Vy"}],"key":"kLwLhZIRxh"},{"type":"heading","depth":3,"position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"JSON file","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"zHok2GHd5Y"}],"identifier":"json-file","label":"JSON file","html_id":"json-file","implicit":true,"key":"aGjn3sVvIb"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"So that others can find and use the new process, it must be described in a JSON file. Information about the use case and the input and output of the process is recorded here. Examples can also be found in a ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"TDVrcYEHyH"},{"type":"link","url":"https://github.com/eodcgmbh/openeo-processes","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"github repository","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"Jhg3zQhNf0"}],"urlSource":"https://github.com/eodcgmbh/openeo-processes","error":true,"key":"EyHwRgOqxo"},{"type":"text","value":".","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"HNI0TCpPZF"}],"key":"YB0qjT6BXt"},{"type":"heading","depth":2,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"3. Pushing the process into the openEO processes dask","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"dCe4XpORpE"}],"identifier":"id-3-pushing-the-process-into-the-openeo-processes-dask","label":"3. Pushing the process into the openEO processes dask","html_id":"id-3-pushing-the-process-into-the-openeo-processes-dask","implicit":true,"key":"zWDJSNtYUW"},{"type":"paragraph","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"First you need to create a fork of both GitHub repositories, ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"XljWvp2pXa"},{"type":"link","url":"https://github.com/Open-EO/openeo-processes-dask","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"openeo​-processes​-dask","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"pM4pSGS2NR"}],"urlSource":"https://github.com/Open-EO/openeo-processes-dask","error":true,"key":"WdZfNVqMNm"},{"type":"text","value":" and ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"LVik5FTGup"},{"type":"link","url":"https://github.com/eodcgmbh/openeo-processes/tree/master","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"openeo-processes","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"cmP9hyAWJS"}],"urlSource":"https://github.com/eodcgmbh/openeo-processes/tree/master","error":true,"key":"FRAxaThGzR"},{"type":"text","value":".","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"iiYqphewUq"}],"key":"JwEDvTLTWk"},{"type":"paragraph","position":{"start":{"line":40,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"The repositories can then be cloned to the local system.\n","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"PxL2V4ez64"},{"type":"inlineCode","value":"git clone https://github.com/<YOUR USER NAME>/openeo-processes-dask.git","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"zMps2OKrl5"}],"key":"rgRJLc2DU0"},{"type":"paragraph","position":{"start":{"line":43,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"With ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"HzE9SaYBf9"},{"type":"inlineCode","value":"poetry install --all-extras","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"YkygMNcO1Q"},{"type":"text","value":", all versions of libraries currently used on openEO can be downloaded.\nIf you want to add a new dependency run: ","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"FBKozWnsCZ"},{"type":"inlineCode","value":"poetry add some_new_dependency","position":{"start":{"line":43,"column":1},"end":{"line":43,"column":1}},"key":"r8UksoX9N1"}],"key":"RheJDZWl0l"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"text","value":"All changes must be committed and pushed into a new branch of your openeo-processes-dask fork. Then a pull request can be created to merge the fork into the openeo/openeo-processes-dask.\nHowever, the following points should be noted beforehand:","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"FYhYb84YBL"}],"key":"EUH6NUOqt5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":48,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add comments and documentation for your code","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"UZ6PQnBXzI"}],"key":"P6UHn7AH4p"}],"key":"Fnh2QbC3N9"},{"type":"listItem","spread":true,"position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Make sure your tests still run through and add additional tests","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"key":"gfxwxv2JZv"}],"key":"vIDKJiTVIC"}],"key":"et4VP12BYF"},{"type":"listItem","spread":true,"position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Format your code nicely automatically after every commit - ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"lSV0CAlg6n"},{"type":"inlineCode","value":"run poetry run pre-commit install","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"vUZanZhViO"},{"type":"text","value":" and ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"HcD7FyFNKJ"},{"type":"inlineCode","value":"pre-commit run --all-files","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"xy9dXD8cmL"},{"type":"text","value":" once, then it’ll work for every commit","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"S8AIr361gF"}],"key":"yt8b2pdaPh"}],"key":"Npabf7UriZ"},{"type":"listItem","spread":true,"position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Add a descriptive comment to your commit and push your code to your openeo-processes-dask fork","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"ArTP1cvTlw"}],"key":"JweosGBKvJ"}],"key":"ln50BTTnWQ"},{"type":"listItem","spread":true,"position":{"start":{"line":52,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a PR with a descriptive title for your changes","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"MQaBKNZ9vK"}],"key":"qGM76PoiML"}],"key":"VEJa7rLHj5"}],"key":"tB5A8bTwji"},{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"To add the .json file to eodcgmbh/openeo-processes, you need to push your file into a branch in your fork and create a pull request.","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"fnyxuJjC1j"}],"key":"hFS3xklr0a"},{"type":"paragraph","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"After you requested a pull request, you need to wait for an approval from one of the repository-maintainers. They either approve your pull request or request changes.","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"LmhUcPBLtj"}],"key":"O4gEPSPhzo"},{"type":"heading","depth":2,"position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"4. Example code","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"Lm6GcCHp0G"}],"identifier":"id-4-example-code","label":"4. Example code","html_id":"id-4-example-code","implicit":true,"key":"uvFg22TLSQ"},{"type":"paragraph","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"The .py process file for ddmc looks like this:","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"JT6nxyvfHu"}],"key":"n6bz4RaHME"},{"type":"code","lang":"","value":"from openeo_processes_dask.process_implementations.arrays import array_element\nfrom openeo_processes_dask.process_implementations.cubes.general import add_dimension\nfrom openeo_processes_dask.process_implementations.cubes.merge import merge_cubes\nfrom openeo_processes_dask.process_implementations.cubes.reduce import reduce_dimension\nfrom openeo_processes_dask.process_implementations.data_model import RasterCube\n\n__all__ = [\"ddmc\"]\n\n\ndef ddmc(\n    data: RasterCube,\n    nir08=\"nir08\",\n    nir09=\"nir09\",\n    cirrus=\"cirrus\",\n    swir16=\"swir16\",\n    swir22=\"swir22\",\n    gain=2.5,\n    target_band=None,\n):\n    dimension = data.openeo.band_dims[0]\n    if target_band is None:\n        target_band = dimension\n\n    # Mid-Level Clouds\n    def MIDCL(data):\n        # B08 = array_element(data, label=nir08, axis = axis)\n\n        B08 = data.sel(**{dimension: nir08})\n\n        # B09 = array_element(data, label=nir09, axis = axis)\n\n        B09 = data.sel(**{dimension: nir09})\n\n        MIDCL = B08 - B09\n\n        MIDCL_result = MIDCL * gain\n\n        return MIDCL_result\n\n    # Deep moist convection\n    def DC(data):\n        # B10 = array_element(data, label=cirrus, axis = axis)\n        # B12 = array_element(data, label=swir22, axis = axis)\n\n        B10 = data.sel(**{dimension: cirrus})\n        B12 = data.sel(**{dimension: swir22})\n\n        DC = B10 - B12\n\n        DC_result = DC * gain\n\n        return DC_result\n\n    # low-level cloudiness\n    def LOWCL(data):\n        # B10 = array_element(data, label=cirrus, axis = axis)\n        # B11 = array_element(data, label=swir16, axis = axis)\n        B10 = data.sel(**{dimension: cirrus})\n        B11 = data.sel(**{dimension: swir16})\n\n        LOWCL = B11 - B10\n\n        LOWCL_result = LOWCL * gain\n\n        return LOWCL_result\n\n    # midcl = reduce_dimension(data, reducer=MIDCL, dimension=dimension)\n    midcl = MIDCL(data)\n    midcl = add_dimension(midcl, name=target_band, label=\"midcl\", type=dimension)\n\n    # dc = reduce_dimension(data, reducer=DC, dimension=dimension)\n    dc = DC(data)\n    # dc = add_dimension(dc, target_band, \"dc\")\n    dc = add_dimension(dc, target_band, label=\"dc\", type=dimension)\n\n    # lowcl = reduce_dimension(data, reducer=LOWCL, dimension=dimension)\n    lowcl = LOWCL(data)\n    lowcl = add_dimension(lowcl, target_band, label=\"lowcl\", type=dimension)\n\n    # ddmc = merge_cubes(merge_cubes(midcl, dc), lowcl)\n    ddmc1 = merge_cubes(midcl, lowcl)\n    ddmc1.openeo.add_dim_type(name=target_band, type=dimension)\n    ddmc = merge_cubes(dc, ddmc1, overlap_resolver=target_band)\n\n    # return a datacube\n    return ddmc\n","position":{"start":{"line":62,"column":1},"end":{"line":150,"column":1}},"key":"ABOCjChmxe"},{"type":"paragraph","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"children":[{"type":"text","value":"The .py test file for ddmc looks like this:","position":{"start":{"line":152,"column":1},"end":{"line":152,"column":1}},"key":"v2NA0L6O3s"}],"key":"TKmkNGhNf4"},{"type":"code","lang":"","value":"from functools import partial\n\nimport numpy as np\nimport pytest\nimport xarray as xr\nfrom openeo_pg_parser_networkx.pg_schema import BoundingBox, ParameterReference, TemporalInterval\n\nfrom openeo_processes_dask.process_implementations.cubes.load import load_stac\nfrom openeo_processes_dask.process_implementations.cubes.reduce import (\n    reduce_dimension,\n    reduce_spatial,\n)\nfrom openeo_processes_dask.process_implementations.ddmc import ddmc\nfrom openeo_processes_dask.process_implementations.exceptions import ArrayElementNotAvailable\nfrom tests.general_checks import general_output_checks\nfrom tests.mockdata import create_fake_rastercube\n\n\n@pytest.mark.parametrize(\"size\", [(30, 30, 20, 5)])\n@pytest.mark.parametrize(\"dtype\", [np.float32])\ndef test_ddmc_instance_dims(temporal_interval: TemporalInterval, bounding_box: BoundingBox, random_raster_data):\n    input_cube = create_fake_rastercube(\n        data=random_raster_data,\n        spatial_extent=bounding_box,\n        temporal_extent=temporal_interval,\n        bands=[\"nir08\", \"nir09\", \"cirrus\", \"swir16\", \"swir22\"],\n        backend=\"dask\",\n    )\n\n    data = ddmc(input_cube)\n\n    assert isinstance(data, xr.DataArray)\n    assert set(input_cube.dims) == set(data.dims)\n\n@pytest.mark.parametrize(\"size\", [(30, 30, 20, 5)])\n@pytest.mark.parametrize(\"dtype\", [np.float32])\ndef test_ddmc_target_band(temporal_interval: TemporalInterval, bounding_box: BoundingBox, random_raster_data):\n    input_cube = create_fake_rastercube(\n        data=random_raster_data,\n        spatial_extent=bounding_box,\n        temporal_extent=temporal_interval,\n        bands=[\"nir08\", \"nir09\", \"cirrus\", \"swir16\", \"swir22\"],\n        backend=\"dask\",\n    )\n\n    data_band = ddmc(data=input_cube, target_band=\"ddmc\")\n    assert \"ddmc\" in data_band.dims\n\n@pytest.mark.parametrize(\"size\", [(30, 30, 20, 5)])\n@pytest.mark.parametrize(\"dtype\", [np.float32])\ndef test_ddmc_input_cube_exception(temporal_interval: TemporalInterval, bounding_box: BoundingBox, random_raster_data):\n    input_cube_exception = create_fake_rastercube(\n        data=random_raster_data,\n        spatial_extent=bounding_box,\n        temporal_extent=temporal_interval,\n        bands=[\"b04\", \"nir09\", \"cirrus\", \"swir16\", \"swir22\"],\n        backend=\"dask\",\n    )\n\n    with pytest.raises(KeyError):\n        data = ddmc(input_cube_exception)\n","position":{"start":{"line":154,"column":1},"end":{"line":217,"column":1}},"key":"ZZHVNS6Fjl"},{"type":"paragraph","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"children":[{"type":"text","value":"The .json description file for ddmc looks like this:","position":{"start":{"line":219,"column":1},"end":{"line":219,"column":1}},"key":"fRkO6niwHZ"}],"key":"AOeBeMSAdC"},{"type":"code","lang":"","value":"{\n    \"id\": \"ddmc\",\n    \"summary\": \"Detecting Deep Moist Convection\",\n    \"description\": \"Deep moist convection (DC) is associated with dangerous weather phenomena such as torrential rain, flash floods, large hail and tornadoes. The release of latent heat inside deep convective clouds often plays a crucial role. Studies have shown that DC and overshooting cloud tops penetrate into the lowest stratosphere and enable the exchange of gases from the troposphere deep into the stratosphere. The Sentinel satellites offer the possibility to monitor DC around the globe, independent of the emissivity of the ground. Detecting Deep Moist Convection is a combination of Deep Moist Convection, low- and mid-level cloudiness. \\nThe `data` parameter expects a raster data cube with a dimension, by the default of the type `band` or otherwise another `target_band ` must be specified. By default, the dimension must have at least five bands with the common names `nir08`, `nir09`, `cirrus`, `swir16` and `swir22` assigned. Otherwise, the user has to specify the parameters. The common names for each band are specified in the collection's band metadata and are *not* equal to the band names.\\n\\nBy default, the dimension of type `bands` is renamed by this process. To keep the dimension, specify a new band name in the parameter `target_band`. This adds a new dimension label with the specified name to the dimension, which can be used to access the computed values.\",\n    \"categories\": [\n        \"cubes\",\n        \"math > indices\",\n        \"disaster management and prevention algorithms\"\n    ],\n    \"parameters\": [\n        {\n            \"name\": \"data\",\n            \"description\": \"A raster data cube with five bands that have the common names `nir08`, `nir09`, `cirrus`,  `swir16` and `swir22` assigned.\",\n            \"schema\": {\n                \"type\": \"object\",\n                \"subtype\": \"datacube\",\n                \"dimensions\": [\n                    {\n                        \"type\": \"spatial\",\n                        \"axis\": [\n                            \"x\",\n                            \"y\"\n                        ]\n                    },\n                    {\n                        \"type\": \"bands\"\n                    }\n                ]\n            }\n        },\n        {\n            \"name\": \"nir08\",\n            \"description\": \"The name of the NIR band. Defaults to the band that has the common name `nir` assigned.\\n\\nEither the unique band name (metadata field `name` in bands) or one of the common band names (metadata field `common_name` in bands) can be specified. If the unique band name and the common name conflict, the unique band name has a higher priority.\",\n            \"schema\": {\n                \"type\": \"string\",\n                \"subtype\": \"band-name\"\n            },\n            \"default\": \"nir08\",\n            \"optional\": true\n        },\n\t{\n            \"name\": \"nir09\",\n            \"description\": \"The name of the Water vapour band. Defaults to the band that has the common name `nir09` assigned.\\n\\nEither the unique band name (metadata field `name` in bands) or one of the common band names (metadata field `common_name` in bands) can be specified. If the unique band name and the common name conflict, the unique band name has a higher priority.\",\n            \"schema\": {\n                \"type\": \"string\",\n                \"subtype\": \"band-name\"\n            },\n            \"default\": \"nir09\",\n            \"optional\": true\n        },\n        {\n            \"name\": \"cirrus\",\n            \"description\": \"The name of the SWIR – Cirrus band. Defaults to the band that has the common name `cirrus` assigned.\\n\\nEither the unique band name (metadata field `name` in bands) or one of the common band names (metadata field `common_name` in bands) can be specified. If the unique band name and the common name conflict, the unique band name has a higher priority.\",\n            \"schema\": {\n                \"type\": \"string\",\n                \"subtype\": \"band-name\"\n            },\n            \"default\": \"cirrus\",\n            \"optional\": true\n        },\n\t{\n            \"name\": \"swir16\",\n            \"description\": \"The name of the SWIR (ca 1600 nm) band. Defaults to the band that has the common name `swir16` assigned.\\n\\nEither the unique band name (metadata field `name` in bands) or one of the common band names (metadata field `common_name` in bands) can be specified. If the unique band name and the common name conflict, the unique band name has a higher priority.\",\n            \"schema\": {\n                \"type\": \"string\",\n                \"subtype\": \"band-name\"\n            },\n            \"default\": \"swir16\",\n            \"optional\": true\n        },\n\t{\n            \"name\": \"swir22\",\n            \"description\": \"The name of the SWIR (ca 2200 nm) band. Defaults to the band that has the common name `swir22` assigned.\\n\\nEither the unique band name (metadata field `name` in bands) or one of the common band names (metadata field `common_name` in bands) can be specified. If the unique band name and the common name conflict, the unique band name has a higher priority.\",\n            \"schema\": {\n                \"type\": \"string\",\n                \"subtype\": \"band-name\"\n            },\n            \"default\": \"swir22\",\n            \"optional\": true\n        },\n        {\n            \"name\": \"target_band\",\n            \"description\": \"By default, the dimension is the band dimension. You can specify a new dimension name in this parameter so that a new dimension label with the specified name will be added for the computed values.\",\n            \"schema\": [\n                {\n                    \"type\": \"string\",\n                    \"pattern\": \"^\\\\w+$\"\n                },\n                {\n                    \"type\": \"null\"\n                }\n            ],\n            \"default\": \"band\",\n            \"optional\": true\n        },\n\t{\n            \"name\": \"gain\",\n            \"description\": \"The value by which the indices are to be multiplied. By default, gain is 2.5.\",\n            \"schema\": [\n                {\n                    \"type\": \"double\",\n                    \"pattern\": \"^\\\\w+$\"\n                },\n                {\n                    \"type\": \"null\"\n                }\n            ],\n            \"default\": 2.5,\n            \"optional\": true\n        }\n    ],\n    \"returns\": {\n        \"description\": \"A raster data cube containing the computed DDMC values. The structure of the data cube differs depending on the value passed to `target_band`:\\n `target_band` is a string: The data cube keeps the same dimensions. The dimension properties remain unchanged, but the number of dimension labels for the dimension of type `bands` increases by one. The additional label is named as specified in `target_band`.\",\n        \"schema\": {\n            \"type\": \"object\",\n            \"subtype\": \"datacube\",\n            \"dimensions\": [\n                {\n                    \"type\": \"spatial\",\n                    \"axis\": [\n                        \"x\",\n                        \"y\"\n                    ]\n                }\n            ]\n        }\n    },\n    \"links\": [\n        {\n            \"rel\": \"about\",\n            \"href\": \"https://custom-scripts.sentinel-hub.com/custom-scripts/sentinel-2/deep_moist_convection/\",\n            \"title\": \"DDMC explained by sentinelhub\"\n        },\n        {\n            \"rel\": \"about\",\n            \"href\": \"https://earthobservatory.nasa.gov/features/MeasuringVegetation/measuring_vegetation_2.php\",\n            \"title\": \"NDVI explained by NASA\"\n        }\n    ]\n}","position":{"start":{"line":221,"column":1},"end":{"line":362,"column":1}},"key":"zr1Io9OcMC"}],"key":"tPUsJqGSkk"}],"key":"MVfnrj0hnq"},"references":{"cite":{"order":[],"data":{}}}}