{"version":2,"kind":"Notebook","sha256":"2aa5d9d684045a0fc60cf385967d4a74fd15e4f30bba5cde2260b0e823e330e4","slug":"gfm-filter","location":"/source/services/GFM/gfm_filter.ipynb","dependencies":[],"frontmatter":{"title":"Refine STAC query using filters","subtitle":"In this notebook, we demonstrate how to refine the query against the GFM STAC catalogue using the filter STAC API extension","tags":["GFM","filter"],"copyright":"Â© 2024 eodc","authors":[{"id":"Author: eodc","name":"Author: eodc"}],"license":{"content":{"id":"MIT","url":"https://opensource.org/licenses/MIT","name":"MIT License","free":true,"osi":true}},"thumbnail":"/e09f7271f6c188a68020a7d6a49ba21c.svg","kernelspec":{"name":"python3","display_name":"eodc_cluster","language":"python"},"numbering":{"title":{"offset":2}},"exports":[{"format":"ipynb","filename":"gfm_filter.ipynb","url":"/gfm_filter-41993aff00288a1251af7bfa2707267d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"You can find the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CndNdm0ZE9"},{"type":"link","url":"https://github.com/stac-api-extensions/filter","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"filter STAC API extension","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"R09e4jFqny"}],"urlSource":"https://github.com/stac-api-extensions/filter","error":true,"key":"B420DCBokM"},{"type":"text","value":" here.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EQUcpRBRi9"}],"key":"G1aIsgn8Rk"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The filter extension references behavior defined in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"N2tMx8lu6v"},{"type":"link","url":"https://github.com/opengeospatial/ogcapi-features/tree/master/extensions/filtering","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"OGC API - Features - Part 3: Filtering and the Common Query Language (CQL2)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"emdaxrelfw"}],"urlSource":"https://github.com/opengeospatial/ogcapi-features/tree/master/extensions/filtering","error":true,"key":"eUmvcEWLFX"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Dv0aiVxmNh"},{"type":"link","url":"https://github.com/opengeospatial/ogcapi-features/blob/master/cql2/README.md","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Common Query Language (CQL2)","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vKWeuTjfks"}],"urlSource":"https://github.com/opengeospatial/ogcapi-features/blob/master/cql2/README.md","data":{"kind":"file","org":"opengeospatial","repo":"ogcapi-features","reference":"master","file":"cql2/README.md","raw":"https://raw.githubusercontent.com/opengeospatial/ogcapi-features/master/cql2/README.md"},"internal":false,"protocol":"github","key":"oiYgzc2AqK"},{"type":"text","value":" specifications.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"he3ZdNmXHo"}],"key":"XrCXJKTktS"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The following queryables and combinations thereof are used:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"H34ColNZn3"}],"key":"BXYQ430ILJ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Equi7Tile","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"B4LZ76TgPu"}],"key":"SVbISJcl56"}],"key":"jMLYepwLSq"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"ratio_after_blob_removal","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dUwgad06pY"}],"key":"TLbKBQISu2"}],"key":"OW0P4ZsBus"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"flooded_pixels","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ner1tvPtAI"}],"key":"MB5SLnwzoB"}],"key":"X6eOVbBpvI"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"anomaly_detected","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"rfTOKqQ2GA"}],"key":"jvhFgw60ft"}],"key":"FQznKGo74N"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"sensing_date","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"KCmcHsJVrM"}],"key":"xzLiRyb6Es"}],"key":"MGZmo06Npn"}],"key":"TrYkctURjd"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"More examples are shown ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"BENYdKmxQc"},{"type":"link","url":"https://github.com/stac-api-extensions/filter?tab=readme-ov-file#examples","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"t3LJ08rz2I"}],"urlSource":"https://github.com/stac-api-extensions/filter?tab=readme-ov-file#examples","error":true,"key":"dJ051tcgLb"},{"type":"text","value":".","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"k3tmXGu0RH"}],"key":"pX6scd9oDJ"}],"key":"guUjxPJYRt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from pystac_client import Client\n\napi_url = \"https://stac.eodc.eu/api/v1\"\neodc_catalog = Client.open(api_url)","key":"GjhyzwgX5p"},{"type":"output","id":"Jc0VO6_fS07XcpAtpnzUV","data":[],"key":"UtzRAeD1Au"}],"key":"Q2dyDIq5wn"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filter for Equi7Tile","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qvLSiZ4B4Q"}],"identifier":"filter-for-equi7tile","label":"Filter for Equi7Tile","html_id":"filter-for-equi7tile","implicit":true,"key":"d0oFttaooa"}],"key":"fKX42sTbU9"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filt = {\n    \"op\": \"eq\",\n    \"args\": [\n        {\"property\": \"Equi7Tile\"}, \"AS020M_E045N012T3\"\n    ]\n}\n\nsearch = eodc_catalog.search(collections=\"GFM\", filter=filt)\n\nprint(\"We found\", search.matched(), \"items, that match our filter criteria.\")","key":"N2tgBh29A7"},{"type":"output","id":"0oC-y_LV_U-kKYkqU8ENs","data":[],"key":"dN6tWzVlB4"}],"key":"wDWk5oJtP9"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filter for ratio_after_blob_removal","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ri6jRbntbw"}],"identifier":"filter-for-ratio-after-blob-removal","label":"Filter for ratio_after_blob_removal","html_id":"filter-for-ratio-after-blob-removal","implicit":true,"key":"W0qwlOWHpN"}],"key":"rsktqUxMF6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filt = {\n    \"op\": \"gt\",\n    \"args\": [\n        {\"property\": \"ratio_after_blob_removal\"}, 0.9\n    ]\n}\n\nsearch = eodc_catalog.search(collections=\"GFM\", filter=filt)\n\nprint(\"We found\", search.matched(), \"items, that match our filter criteria.\")","key":"aTuUNjDJuI"},{"type":"output","id":"XhhjDSWQSSMjhyETnWwk6","data":[],"key":"yCRPlWGlXL"}],"key":"eui0moCbaq"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filter for flooded_pixels","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"th0U10N98L"}],"identifier":"filter-for-flooded-pixels","label":"Filter for flooded_pixels","html_id":"filter-for-flooded-pixels","implicit":true,"key":"mupyt7BXAl"}],"key":"YJmTjIfDv3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filt = {\n    \"op\": \"gt\",\n    \"args\": [\n        {\"property\": \"flooded_pixels\"}, 5000000\n    ]\n}\n\nsearch = eodc_catalog.search(collections=\"GFM\", filter=filt)\n\nprint(\"We found\", search.matched(), \"items, that match our filter criteria.\")","key":"XDHOv1KguQ"},{"type":"output","id":"5p4YH776lTZXJYoiQ6xni","data":[],"key":"aYoDhXXYaa"}],"key":"r4NVDWggbB"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filter for anomaly_detected","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UTK6RYQrpa"}],"identifier":"filter-for-anomaly-detected","label":"Filter for anomaly_detected","html_id":"filter-for-anomaly-detected","implicit":true,"key":"W0bJsXEPRl"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Currently, this property is not available, but will be added soon!","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"t1dfiq78KI"}],"key":"hHFeICTOLY"}],"key":"KkO6Ru0RgO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filt = {\n    \"op\": \"eq\",\n    \"args\": [\n        {\"property\": \"anomaly_detected\"}, True\n    ]\n}\n\nsearch = eodc_catalog.search(collections=\"GFM\", filter=filt)\n\nprint(\"We found\", search.matched(), \"items, that match our filter criteria.\")","key":"KBiizwsrdp"},{"type":"output","id":"n8U7OBb_jf95CuGJV7QnL","data":[],"key":"U7laaQ9CWw"}],"key":"kKFRHAoQ5d"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Combinations of queryables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nHnVZawLDc"}],"identifier":"combinations-of-queryables","label":"Combinations of queryables","html_id":"combinations-of-queryables","implicit":true,"key":"tIezzNzMJV"}],"key":"FshRcTaT5o"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filt = {\n    \"op\": \"and\",\n    \"args\": [\n        {\n            \"op\": \"eq\",\n            \"args\": [\n                {\"property\": \"Equi7Tile\"}, \"AS020M_E045N012T3\"\n            ]\n        },\n        {\n            \"op\": \"gt\",\n            \"args\": [\n                {\"property\": \"ratio_after_blob_removal\"}, 0.7\n            ]\n        },\n    ]\n}\n\nsearch = eodc_catalog.search(collections=\"GFM\", filter=filt)\n\nprint(\"We found\", search.matched(), \"items, that match our filter criteria.\")","key":"oSZQweF1VX"},{"type":"output","id":"yvBzZL0y7wTq2_UE-KNf_","data":[],"key":"Q81EL4YeFM"}],"key":"jPgQBbf1AJ"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List ID of found items","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"f8E6KpRIvH"}],"identifier":"list-id-of-found-items","label":"List ID of found items","html_id":"list-id-of-found-items","implicit":true,"key":"fcjaWbQbSJ"}],"key":"FDxHRfsl81"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"for item in search.item_collection():\n    print(item.id)","key":"bozPMl7BZF"},{"type":"output","id":"AObDN2L1UFYTVktlLRw8O","data":[],"key":"pSru4v1izE"}],"key":"r8DX86iEWX"}],"key":"Qoa3IciFU8"},"references":{"cite":{"order":[],"data":{}}}}